---
stepsCompleted:
  - step-01-init
  - step-02-discovery
  - step-03-success
  - step-04-journeys
  - step-05-domain
  - step-06-innovation
  - step-07-project-type
  - step-08-scoping
  - step-09-functional
  - step-10-nonfunctional
  - step-11-polish
  - step-12-complete
inputDocuments:
  - docs/index.md
  - docs/api-contracts-backend.md
  - docs/data-models-backend.md
  - docs/component-inventory-frontend.md
  - docs/source-tree-analysis.md
  - docs/development-operations.md
  - docs/integration-architecture.md
  - docs/external-integrations.md
documentCounts:
  briefs: 0
  research: 0
  brainstorming: 0
  projectDocs: 8
workflowType: 'prd'
classification:
  projectType: web_app
  domain: general
  complexity: low-medium
  projectContext: brownfield
featureScope:
  name: 週期性預約功能
  recurrencePatterns:
    - weekly
    - bi-weekly
    - monthly-fixed-date
    - monthly-fixed-weekday
  endConditions:
    - by-date
    - by-count
  conflictHandling: user-selection
  editOptions:
    - single-occurrence
    - this-and-future
    - entire-series
  permissions: all-users
  rulesInherited: true
  maxOccurrences: unlimited
---

# Product Requirements Document - bookingSystem

**Author:** enci
**Date:** 2026-01-19

## 成功標準

### 用戶成功

- 用戶能夠成功建立週期性預約
- 用戶能夠編輯/取消單次、此後所有、或整個週期
- 衝突時能清楚看到並選擇保留哪些場次

### 技術成功

- 功能與現有系統無縫整合
- 所有週期模式（每週、隔週、每月固定日、每月固定週次）正常運作
- 現有預約規則（時段限制）正確套用
- 單元測試與 E2E 測試通過

### 可量化結果

- 功能開發完成並部署上線
- 無嚴重 Bug 影響現有預約功能

## 用戶旅程

### 旅程 1：一般使用者 - 建立週期性預約

**角色：** 王教授，資工系教師

**情境：** 王教授每週三下午 2:00-4:00 需要召開研究室會議，為期一整個學期（約 18 週）。

**旅程：**
1. 王教授登入系統，進入預約頁面
2. 選擇會議室 A101，點擊「週期性預約」
3. 設定：每週三、14:00-16:00、重複至學期末（6月30日）
4. 系統檢查 18 週的時段，顯示全部可用
5. 確認建立，收到 Email 通知
6. 日曆上顯示整學期的週期預約

**結果：** 一次設定，整學期會議室預約完成，省去每週重複操作

### 旅程 2：一般使用者 - 處理衝突情況

**角色：** 李同學，研究生

**情境：** 李同學想建立隔週一的讀書會，但部分時段已被佔用。

**旅程：**
1. 李同學選擇會議室 B202，設定隔週一 10:00-12:00，共 8 次
2. 系統檢測發現第 3 次和第 6 次與現有預約衝突
3. 系統顯示衝突清單，詢問如何處理
4. 李同學選擇「跳過衝突場次，建立其他 6 次」
5. 系統建立 6 次預約，並提示哪兩次未建立
6. 李同學可另外為那兩次尋找替代會議室

**結果：** 用戶清楚了解衝突狀況，自主決定處理方式

### 旅程 3：一般使用者 - 修改/取消週期預約

**角色：** 王教授

**情境：** 學期中，王教授因故需要調整會議時間。

**旅程：**
1. 王教授在日曆上點擊某次週期預約
2. 系統顯示選項：「僅此次」「此次及之後」「整個週期」
3. 王教授選擇「此次及之後」，將時間改為 15:00-17:00
4. 系統更新該次及後續所有預約
5. 收到更新確認 Email

**結果：** 靈活調整週期預約，不影響已完成的歷史紀錄

### 旅程 4：管理員 - 管理週期性預約

**角色：** 陳管理員，系辦助理

**情境：** 有用戶反映預約衝突，管理員需要協調處理。

**旅程：**
1. 陳管理員登入管理後台
2. 查看會議室 A101 的預約狀況，發現兩個週期預約有重疊
3. 聯繫相關用戶協調
4. 代為修改或取消其中一方的部分場次
5. 系統記錄操作日誌

**結果：** 管理員能有效查看並協調週期預約衝突

### 旅程需求摘要

| 旅程 | 揭示的功能需求 |
|------|----------------|
| 旅程 1 | 週期預約建立 UI、週期模式設定、批次衝突檢查、Email 通知 |
| 旅程 2 | 衝突檢測與顯示、用戶選擇保留機制、部分建立功能 |
| 旅程 3 | 週期預約編輯 UI、三種編輯範圍、批次更新邏輯 |
| 旅程 4 | 管理員查看週期預約、代理操作權限、操作日誌記錄 |

## Web App 專屬需求

### 專案類型概覽

本功能是現有 Vue.js 3.4 SPA 會議室預約系統的功能擴展，採用與現有系統一致的技術架構和設計模式。

### 技術架構考量

**衝突檢測機制（MVP）**
- MVP 階段不實作即時日曆更新
- 僅在用戶新增預約時即時檢查是否有衝突
- 後續版本再評估 WebSocket/SSE 即時更新需求

**前端整合策略**
- 在現有預約表單（application.vue）中新增「重複」選項
- 不建立獨立的週期預約入口
- 維持現有 UI/UX 一致性

### 實作考量

**前端變更**

| 元件 | 變更內容 |
|------|----------|
| application.vue | 新增週期設定區塊 |
| calendar.vue | 支援顯示週期預約 |

**後端變更**

| 模組 | 變更內容 |
|------|----------|
| api/reservation.js | 新增週期預約 CRUD 端點 |
| model/reservation.js | 週期預約資料模型與批次操作 |

**資料庫變更**
- Reservation 表需新增欄位追蹤週期關聯
- 或新增 RecurringReservation 表管理週期規則

## 專案範圍與階段開發

### MVP 策略與理念

**MVP 方法：** 問題解決型 - 專注於解決「重複預約操作繁瑣」的核心問題
**資源需求：** 1-2 位全端開發人員

### MVP 功能集（Phase 1）

**支援的核心用戶旅程：**
- 旅程 1：建立週期性預約
- 旅程 2：處理衝突情況
- 旅程 3：修改/取消週期預約
- 旅程 4：管理員管理週期預約

**必備功能：**
- 週期預約建立（每週、隔週、每月固定日、每月固定週次）
- 結束條件設定（指定日期或重複次數）
- 建立時衝突檢測與用戶選擇
- 週期預約編輯/取消（僅此次、此次及之後、整個週期）
- 管理員代理操作權限
- Email 通知整合

### 後續功能

**Phase 2（成長）：**
- 週期預約使用統計報表
- 週期預約範本（快速套用常用設定）
- 即時日曆更新（若資源許可）

**Phase 3（願景）：**
- 行事曆同步（Google Calendar / Outlook）
- 智慧推薦最佳會議時段

### 風險緩解策略

| 風險類型 | 風險描述 | 緩解策略 |
|----------|----------|----------|
| **技術風險** | 即時更新機制整合複雜度 | MVP 不實作即時更新，僅在用戶新增預約時即時檢查衝突；後續版本再評估 |
| **資料風險** | 週期預約批次操作可能影響效能 | 實作時加入交易處理與批次限制 |
| **相容風險** | 與現有預約功能的整合 | 充分測試邊界案例 |

## 功能需求

### 週期預約建立

- **FR1:** 使用者可以建立每週重複的預約
- **FR2:** 使用者可以建立隔週重複的預約
- **FR3:** 使用者可以建立每月固定日期的預約
- **FR4:** 使用者可以建立每月固定週次的預約（如：每月第一個週五）
- **FR5:** 使用者可以設定週期預約的結束日期
- **FR6:** 使用者可以設定週期預約的重複次數

### 衝突管理

- **FR7:** 系統可以在建立週期預約時檢測所有場次的時段衝突
- **FR8:** 使用者可以查看週期預約的衝突清單
- **FR9:** 使用者可以選擇跳過衝突場次並建立其他可用場次
- **FR10:** 使用者可以選擇取消整個週期預約建立

### 週期預約編輯與取消

- **FR11:** 使用者可以編輯單一場次的週期預約
- **FR12:** 使用者可以編輯某場次及其之後所有場次
- **FR13:** 使用者可以編輯整個週期預約系列
- **FR14:** 使用者可以取消單一場次的週期預約
- **FR15:** 使用者可以取消某場次及其之後所有場次
- **FR16:** 使用者可以取消整個週期預約系列

### 日曆顯示

- **FR17:** 使用者可以在日曆上查看週期預約的所有場次
- **FR18:** 使用者可以識別哪些預約屬於同一個週期系列

### 管理員功能

- **FR19:** 管理員可以查看所有使用者的週期預約
- **FR20:** 管理員可以代理編輯使用者的週期預約
- **FR21:** 管理員可以代理取消使用者的週期預約
- **FR22:** 系統可以記錄管理員對週期預約的操作日誌

### 規則整合

- **FR23:** 系統可以將現有預約規則（時段限制）套用至週期預約
- **FR24:** 一般使用者的週期預約受限於工作日 8:00-18:00

### 通知

- **FR25:** 系統可以在週期預約建立成功時發送 Email 通知
- **FR26:** 系統可以在週期預約修改時發送 Email 通知
- **FR27:** 系統可以在週期預約取消時發送 Email 通知

## 非功能需求

### 效能

- **NFR1:** 週期預約建立時的衝突檢查應在 3 秒內完成（最多 52 週）
- **NFR2:** 日曆載入週期預約顯示應在 2 秒內完成
- **NFR3:** 批次編輯/取消操作應在 5 秒內完成

### 整合

- **NFR4:** 週期預約功能應與現有預約 API 保持一致的介面風格
- **NFR5:** 週期預約應完整整合現有 Email 通知機制
- **NFR6:** 週期預約應遵循現有權限控制機制（privilege_level）

### 資料一致性

- **NFR7:** 週期預約的批次操作應使用資料庫交易，確保原子性
- **NFR8:** 系統應防止週期預約建立時的競爭條件（race condition）

